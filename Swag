Sub GenerateDirectorPresentations()
    Dim ws As Worksheet
    Dim pptApp As Object
    Dim pptPres As Object
    Dim pptSlide As Object
    Dim tcChart As Object
    Dim lastRow As Long
    Dim directorDict As Object
    Dim stageCount As Object
    Dim director As Variant
    Dim stages As Variant
    Dim slidePath As String
    Dim outputPath As String
    
    ' Set references to the Excel sheet and initialize variables
    Set ws = ThisWorkbook.Sheets("New Plan Pipeline")
    lastRow = ws.Cells(ws.Rows.Count, "A").End(xlUp).Row
    Set directorDict = CreateObject("Scripting.Dictionary")
    Set stageCount = CreateObject("Scripting.Dictionary")
    
    ' Gather all directors and stages in the dataset
    For i = 2 To lastRow
        director = ws.Cells(i, "B").Value ' Column "Director"
        stage = ws.Cells(i, "E").Value    ' Column "Stage"
        
        ' Add director to dictionary
        If Not directorDict.exists(director) Then
            directorDict.Add director, CreateObject("Scripting.Dictionary")
        End If
        
        ' Add stage to the director's dictionary and count occurrences
        If Not directorDict(director).exists(stage) Then
            directorDict(director).Add stage, 0
        End If
        directorDict(director)(stage) = directorDict(director)(stage) + 1
    Next i
    
    ' Create PowerPoint instance
    Set pptApp = CreateObject("PowerPoint.Application")
    pptApp.Visible = True
    
    ' Set the template path (update this path accordingly)
    slidePath = "C:\Path\To\Template.pptx"
    outputPath = "C:\Path\To\Output\"

    ' Loop through each director to create presentations
    For Each director In directorDict.Keys
        Set pptPres = pptApp.Presentations.Open(slidePath)
        Set pptSlide = pptPres.Slides(2) ' Access Slide 2
        
        ' Prepare data for Think-Cell chart
        stages = directorDict(director).keys
        Dim chartData() As Variant
        ReDim chartData(1 To UBound(stages) + 1, 1 To 2)
        
        ' Populate chart data with stage names and counts
        Dim j As Long
        For j = 1 To UBound(stages) + 1
            chartData(j, 1) = stages(j - 1) ' Stage name
            chartData(j, 2) = directorDict(director)(stages(j - 1)) ' Count
        Next j
        
        ' Update Think-Cell chart
        For Each tcChart In pptSlide.Shapes
            If tcChart.Type = msoLinkedOLEObject Then
                If InStr(tcChart.OLEFormat.progID, "ThinkCell.Chart") > 0 Then
                    tcChart.OLEFormat.Object.SetData chartData
                    Exit For
                End If
            End If
        Next tcChart
        
        ' Save the presentation with the director's name
        pptPres.SaveAs outputPath & director & "_Presentation.pptx"
        pptPres.Close
    Next director
    
    ' Cleanup
    pptApp.Quit
    Set pptApp = Nothing
    Set directorDict = Nothing
    Set stageCount = Nothing
    
    MsgBox "Presentations created successfully!", vbInformation
End Sub
