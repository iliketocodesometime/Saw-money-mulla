'=== (l4) Slide 4: Workplace Banking Table ===
Dim wsWorkplace As Worksheet
On Error Resume Next
Set wsWorkplace = ThisWorkbook.Sheets("Workplace Banking Closed Won")
On Error GoTo 0

If Not wsWorkplace Is Nothing Then
    Dim colDirWB As Long, colPartWB As Long
    colDirWB = FindColumnIndex(wsWorkplace, "Director")
    colPartWB = FindColumnIndex(wsWorkplace, "# US Participants")

    If colDirWB > 0 And colPartWB > 0 Then
        Dim lastRowWB As Long
        lastRowWB = wsWorkplace.Cells(wsWorkplace.Rows.Count, colDirWB).End(xlUp).Row

        Dim totalParticipantsWB As Long: totalParticipantsWB = 0
        Dim totalClientsWB As Long: totalClientsWB = 0
        Dim dirParticipantsWB As Long: dirParticipantsWB = 0
        Dim dirClientsWB As Long: dirClientsWB = 0

        For iRow = 2 To lastRowWB
            Dim dirWB As String
            dirWB = Trim(wsWorkplace.Cells(iRow, colDirWB).Value)
            If IsDirectorValid(dirWB) Then
                totalClientsWB = totalClientsWB + 1
                If IsNumeric(wsWorkplace.Cells(iRow, colPartWB).Value) Then
                    totalParticipantsWB = totalParticipantsWB + wsWorkplace.Cells(iRow, colPartWB).Value
                End If
                
                If dirWB = director Then
                    dirClientsWB = dirClientsWB + 1
                    If IsNumeric(wsWorkplace.Cells(iRow, colPartWB).Value) Then
                        dirParticipantsWB = dirParticipantsWB + wsWorkplace.Cells(iRow, colPartWB).Value
                    End If
                End If
            End If
        Next iRow

        Dim shpDeep As PowerPoint.Shape
        On Error Resume Next
        Set shpDeep = pres.Slides(4).Shapes("TableDeep")
        On Error GoTo 0

        If Not shpDeep Is Nothing Then
            With shpDeep.Table
                .Cell(1, 3).Shape.TextFrame.TextRange.Text = "Workplace Banking"
                .Cell(2, 3).Shape.TextFrame.TextRange.Text = _
                    totalParticipantsWB & " participants / " & totalClientsWB & " clients"
                .Cell(3, 3).Shape.TextFrame.TextRange.Text = _
                    dirParticipantsWB & " participants / " & dirClientsWB & " clients"
                If totalParticipantsWB > 0 Then
                    .Cell(4, 3).Shape.TextFrame.TextRange.Text = _
                        Format(dirParticipantsWB / totalParticipantsWB, "0.0%")
                Else
                    .Cell(4, 3).Shape.TextFrame.TextRange.Text = "N/A"
                End If
            End With
        End If
    End If
End If
