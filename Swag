'=== (l5) Slide 4: ThinkCell "DeepPipe" (Workplace Banking Pipeline) ===
Dim wsWBPipe As Worksheet
On Error Resume Next
Set wsWBPipe = ThisWorkbook.Sheets("Workplace Banking Pipeline")
On Error GoTo 0

If Not wsWBPipe Is Nothing And Not tcXlAddIn Is Nothing Then
    Dim colDirWBPipe As Long, colStageWBPipe As Long
    colDirWBPipe = FindColumnIndex(wsWBPipe, "Director")
    colStageWBPipe = FindColumnIndex(wsWBPipe, "Stage")

    If colDirWBPipe > 0 And colStageWBPipe > 0 Then
        Dim stageLabelsWB As Variant
        stageLabelsWB = Array("Early Stage", "Active Pursuit", "Shortlisted / Decision Pending", "Verbal Agreement", "Contract Negotiation")

        Dim deepPipeCounts(1 To 5) As Long
        Dim lastRowWBPipe As Long
        lastRowWBPipe = wsWBPipe.Cells(wsWBPipe.Rows.Count, colDirWBPipe).End(xlUp).Row

        For iRow = 2 To lastRowWBPipe
            If Trim(wsWBPipe.Cells(iRow, colDirWBPipe).Value) = director Then
                Dim stageValWB As String
                stageValWB = Trim(wsWBPipe.Cells(iRow, colStageWBPipe).Value)
                Dim idxWB As Long: idxWB = MatchStageIndex(stageValWB, stageLabelsWB)
                If idxWB > 0 Then deepPipeCounts(idxWB) = deepPipeCounts(idxWB) + 1
            End If
        Next iRow

        With wsHelper
            .Range("A1:B7").ClearContents
            .Range("A1").Value = "Deepening Pipeline"
            .Range("B1").Value = director ' optional label
            .Range("A3").Value = "Early Stage"
            .Range("A4").Value = "Active Pursuit"
            .Range("A5").Value = "Shortlisted / Decision Pending"
            .Range("A6").Value = "Verbal Agreement"
            .Range("A7").Value = "Contract Negotiation"
            
            Dim rrWB As Long
            For rrWB = 1 To 5
                .Cells(rrWB + 2, 2).Value = BlankIfZero(deepPipeCounts(rrWB))
            Next rrWB
        End With

        Dim rngDeepPipe As Range
        Set rngDeepPipe = wsHelper.Range("A1:B7")
        tcXlAddIn.UpdateChart pres.Slides(4), "DeepPipe", rngDeepPipe, False
    End If
End If
