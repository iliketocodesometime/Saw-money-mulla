'=== (l2) Slide 4: ThinkCell Chart 126 (Upsell Pipeline by Stage & Business Line) ===
If upsellAvailable And Not tcXlAddIn Is Nothing Then
    Dim stageMap As Variant
    stageMap = Array("Active Pursuit", "Shortlisted / Decision Pending", "Verbal Agreement", "Contract Negotiation")
    
    Dim upsellPipe(1 To 4, 1 To 3) As Long ' 4 stages Ã— 3 lines
    For r = 1 To 4: For c = 1 To 3: upsellPipe(r, c) = 0: Next c: Next r
    
    For iRow = 2 To lastRowUpsell
        If Not IsError(wsUpsellClosed.Cells(iRow, colDirUpsell).Value) And _
           Not IsError(wsUpsellClosed.Cells(iRow, colStageUpsell).Value) And _
           Not IsError(wsUpsellClosed.Cells(iRow, colLineUpsell).Value) Then
           
           If Trim(wsUpsellClosed.Cells(iRow, colDirUpsell).Value) = director Then
                Dim sIdx As Long: sIdx = MatchStageIndex(Trim(wsUpsellClosed.Cells(iRow, colStageUpsell).Value), stageMap)
                Dim lIdx As Long: lIdx = MatchGASIndex(Trim(wsUpsellClosed.Cells(iRow, colLineUpsell).Value), arrGAS)
                If sIdx > 0 And lIdx > 0 Then upsellPipe(sIdx, lIdx) = upsellPipe(sIdx, lIdx) + 1
           End If
        End If
    Next iRow
    
    With wsHelper
        .Range("A1:E10").ClearContents
        .Range("A1").Value = "Upsell Pipeline"
        .Range("B1").Resize(1, 3).Value = arrGAS
        For r = 1 To 4
            .Cells(r + 1, 1).Value = stageMap(r - 1)
            For c = 1 To 3
                .Cells(r + 1, c + 1).Value = BlankIfZero(upsellPipe(r, c))
            Next c
        Next r
    End With
    
    Dim rngUpsellPipe As Range
    Set rngUpsellPipe = wsHelper.Range("A1:D6")
    tcXlAddIn.UpdateChart pres.Slides(4), "Chart 126", rngUpsellPipe, False
End If
